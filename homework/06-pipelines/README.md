# Домашнее задание - продвинутый пайплайн

На воркшопе мы сделали [пайплайн](https://gitlab.ozon.dev/qa/classroom-3/device-api-e2e/-/blob/master/.gitlab-ci.yml) запуска тестов device-api, но он всё ещё сырой и его нужно улучшить.

## Задание.

Сейчас пайплайн с линтером и пайплайн запуска тестов запускаются в одном и том же контейнере. На случай проблем с dev-зависимостями или конфликтов при совместной разработке хорошо было бы иметь два разных контейнера - один с линтерами, другой только с необходимыми для запуска тестов зависимостями.

Подсказка - запуск джоб в разных контейнерах можно настроить сделав разные джобы с соответствующими only и except инструкциями. 

## Критерии приёмки:

 - Если тесты запускаются из веб-интерфейса, другого пайплайна или по расписанию, тесты гоняются в master-контейнере без dev-зависимостей
 - Линтинг и пробный прогон при создании MR при этом продолжает работать в dev-контейнере
 - Общие для разных джоб действия вынесены в hidden job
 
## Задание со звездочкой*:

 - Настроить нотификацию о прогнанных тестах в слак с помощью web-hook


### Инструкция по dependency proxy
 - Нужно получить DOCKER_AUTH_CONFIG переменную окружения. Как это сделать:

```
# Ваш :gitlab: login: foo
# Ваш :gitlab: password: bar
echo -n 'foo:bar' | base64
Zm9vOmJhcg==
```
Для корректного энкодинга пароля в base64 ОБЯЗАТЕЛЬНО надо использовать ключ -n echo -n "foo:bar" | base64  . Иначе в конец строки пароля попадет символ переноса строки - и вы получите проблемы с логином в гитлаб


 - Открываем ваш проект на :gitlab: :
```
Settings -> CI/CD -> Variables -> Expand -> Add variable
```
 - Key: DOCKER_AUTH_CONFIG
```
{
    "auths": {
        "gitlab.ozon.dev": {
            "auth": "Zm9vOmJhcg=="
        }
    }
} 
```
 - Update variable
 - Снимаем чекбокс с Protect variable 

Dependency Proxy image prefix: gitlab.ozon.dev/qa/classroom-3/students/dependency_proxy/containers
